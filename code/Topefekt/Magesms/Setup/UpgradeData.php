<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2017 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
 namespace Topefekt\Magesms\Setup; use Magento\Framework\Setup\ModuleContextInterface; use Magento\Framework\Setup\ModuleDataSetupInterface; use Magento\Framework\Setup\UpgradeDataInterface; class UpgradeData implements UpgradeDataInterface { protected $attribute; protected $eavSetupFactory; protected $attributeSetFactory; protected $customerSetupFactory; public function __construct(\Magento\Catalog\Model\ResourceModel\Eav\Attribute $i76200fed8240be52de0fc75ec3367898a197407f, \Magento\Eav\Setup\EavSetupFactory $i78c82c3a4b85ed9052cd6f9da2c893476eea8947, \Magento\Customer\Setup\CustomerSetupFactory $i0d105afcbd289ab977fc58cd4257379ded3288b2, \Magento\Eav\Model\Entity\Attribute\SetFactory $i54f3206a53355bb1ec962ed67159a63714c2b8e7) { $this->attribute = $i76200fed8240be52de0fc75ec3367898a197407f; $this->eavSetupFactory = $i78c82c3a4b85ed9052cd6f9da2c893476eea8947; $this->attributeSetFactory = $i54f3206a53355bb1ec962ed67159a63714c2b8e7; $this->customerSetupFactory = $i0d105afcbd289ab977fc58cd4257379ded3288b2; } public function upgrade(ModuleDataSetupInterface $iae3e2ffb6c51b544cd0688f6a7936cf83969b8a9, ModuleContextInterface $i31cc913adc2717e2346d503153c97449098831aa) { $iae3e2ffb6c51b544cd0688f6a7936cf83969b8a9->startSetup(); if (version_compare($i31cc913adc2717e2346d503153c97449098831aa->getVersion(), '2.0.0', '<')) { $id57d139cfcd7590b603d5b061a6237d01bc011b2 = $this->attribute->loadByCode('catalog_product', 'magesms_optout'); if (!$id57d139cfcd7590b603d5b061a6237d01bc011b2->getId()) { $id9c0c5ee549ba822a2f13ae4025ffc7f6a1c6e95 = $this->eavSetupFactory->create(['setup' => $iae3e2ffb6c51b544cd0688f6a7936cf83969b8a9]); $id9c0c5ee549ba822a2f13ae4025ffc7f6a1c6e95->addAttribute('catalog_product', 'magesms_optout', array( 'global' => \Magento\Eav\Model\Entity\Attribute\ScopedAttributeInterface::SCOPE_WEBSITE, 'type' => 'int', 'backend' => '', 'frontend' => '', 'label' => 'MageSMS Opt-out', 'input' => 'hidden', 'visible' => false, 'required' => false, 'user_defined' => false, 'default' => '1', 'searchable' => false, 'filterable' => false, 'comparable' => false, 'visible_on_front' => false, 'unique' => false, )); } $id57d139cfcd7590b603d5b061a6237d01bc011b2 = $this->attribute->loadByCode('customer', 'magesms_customer_marketing'); if (!$id57d139cfcd7590b603d5b061a6237d01bc011b2->getId()) { $i746f405ffecbc352455ac3a8e583068a2cd13f76 = $this->customerSetupFactory->create(['setup' => $iae3e2ffb6c51b544cd0688f6a7936cf83969b8a9]); $i720c48abc4285305fc6669e3f98cf10156005a1a = $i746f405ffecbc352455ac3a8e583068a2cd13f76->getEavConfig()->getEntityType('customer'); $i777846b49037125c3bf5873d46a33ab5976c5a42 = $i720c48abc4285305fc6669e3f98cf10156005a1a->getDefaultAttributeSetId(); $ib671b913c9faa4519b4e1f324ea27dd1ccf28d8e = $this->attributeSetFactory->create(); $icd96647a6239faddceaacef4ad19bbca43bfec97 = $ib671b913c9faa4519b4e1f324ea27dd1ccf28d8e->getDefaultGroupId($i777846b49037125c3bf5873d46a33ab5976c5a42); $ib785c6d82dcd4adde0fb9d06bf483791428cdab7 = [ 'magesms_customer_marketing' => [ 'type' => 'int', 'label' => 'MageSMS Customer Marketing', 'input' => 'boolean', 'visible' => true, 'required' => false, 'user_defined' => true, 'default' => 1, 'searchable' => false, 'filterable' => true, 'comparable' => false, 'visible_on_front' => true, 'system' => false, 'unique' => false, 'sort_order' => 1000, 'position' => 1000, ] ]; foreach ($ib785c6d82dcd4adde0fb9d06bf483791428cdab7 as $i312ef1e9194766bdc713cebc5223c620507aaeed => $i2405b57f77c155924068773d1d75ccc7690f01c3) { $i746f405ffecbc352455ac3a8e583068a2cd13f76->addAttribute(\Magento\Customer\Model\Customer::ENTITY, $i312ef1e9194766bdc713cebc5223c620507aaeed, $i2405b57f77c155924068773d1d75ccc7690f01c3); } $i76200fed8240be52de0fc75ec3367898a197407f = $i746f405ffecbc352455ac3a8e583068a2cd13f76->getEavConfig()->getAttribute(\Magento\Customer\Model\Customer::ENTITY, 'magesms_customer_marketing') ->addData([ 'attribute_set_id' => $i777846b49037125c3bf5873d46a33ab5976c5a42, 'attribute_group_id' => $icd96647a6239faddceaacef4ad19bbca43bfec97, 'used_in_forms' => ['adminhtml_customer', 'adminhtml_checkout', 'customer_account_create', 'customer_account_edit'], ]); $i76200fed8240be52de0fc75ec3367898a197407f->save(); } } $iae3e2ffb6c51b544cd0688f6a7936cf83969b8a9->endSetup(); } } 