<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2017 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $block->profile->user; $lang = $block->profile->lang; ?><h2><?php echo __('SMS Marketing - customers found: '); ?><span id="magesms-marketing-countit"><?php echo $block->getCollection()->count(); ?></span></h2><p><?php echo __('Write text of message and use advanced filter to target your marketing campaign.'); ?></p><div id="magesms"><div class="messages"></div><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminTools.gif'); ?>" alt="" /><?php echo __('SMS Marketing - bulk SMS text'); ?></h4><!--<span class="right"><a href="<?php echo $block->getUrl('*/*/template_save', ['type' => 1]); ?>" title="<?php echo __('Save template'); ?>" onclick="showPopup(this);return false;">[<?php echo __('Save template'); ?>]</a>&nbsp;&nbsp;&nbsp;<a href="<?php echo $block->getUrl('*/*/template_load', ['type' => 1]); ?>" title="<?php echo __('Saved Templates'); ?>" onclick="showPopup(this);return false;">[<?php echo __('Saved Templates'); ?>]</a></span>--></div><fieldset class="fieldset"><form name="formSMS" id="magesms_sendsms" data-mage-init='{"validation": {"validationUrl": "<?php echo $block->getUrl('*/*/validate'); ?>"}}' action="<?php echo $block->getUrl('*/*/') ?>" enctype="multipart/form-data" method="post"><?php echo $block->getBlockHtml('formkey') ?><input name="filter" type="hidden" value="<?php echo $block->getRequest()->getParam('filter'); ?>" /><div style="float: left;margin-right:30px;width:450px"><label for="text"><?php echo __('Enter SMS text'); ?></label><br /><div class="margin-form"><textarea name="text" id="text" class="required-entry input-text admin__control-textarea validate-coupon-variable" style="width:420px; height:135px;"><?php echo $block->getRequest()->getParam('text'); ?></textarea></div><div class="clear"></div></div><div style="float: left;margin-right:30px;"><label for="text"><?php echo __('Preview'); ?> (<span id="labelSMS"></span>)</label><br /><div class="margin-form"><textarea name="textfake" id="textfake" disabled="disabled" class="required-entry input-text admin__control-textarea" style="width:420px; height:135px;border:1px solid grey;"></textarea></div><div class="clear"></div></div><div style="float: left;margin:1.5em 0;"><div class="margin-form"><input id="unicode" type="checkbox" value="1" name="unicode" <?php echo $block->getRequest()->getParam('unicode') ? 'checked' : ''; ?> /><label for="unicode"><?php echo __(' Unicode '); ?></label><span style="cursor:help;text-decoration:underline;" title="<?php echo __('Check only if you want to use Chinese, Arabic, Greek, Hebrew, Korean, Cyrillic, etc. or diacritic in the text of your SMS message (Unicode text allows you to insert characters in all fonts and various other symbols simultaneously. Number of characters in one SMS will be reduced to 70).'); ?>" onclick="popup_title(this)">?</span></div><div class="margin-form"><input type="hidden" value="0" name="unique" /><input id="unique" type="checkbox" value="1" name="unique" <?php echo $block->getRequest()->getParam('unique') === '0' ? '' : 'checked'; ?> /><label for="unique"><?php echo __('Remove duplicate numbers'); ?></label></div><div class="margin-form" style="margin-top: 10px"><input id="sendlater" type="checkbox" value="1" onchange="sendlaterx(this)" name="sendlater" <?php echo $block->getRequest()->getParam('sendlater') ? 'checked' : ''; ?> /><label for="sendlater"><?php echo __(' Send later '); ?></label></div><div class="margin-form sendlater-form" id="sendlater-form" style="display: none; padding: 5px 0 0 20px"><label for="date"><?php echo __('Date:'); ?></label><input type="text" style="width: 130px;" class="input-text validate-sendlater-datumodesl admin__control-text" value="<?php echo $block->getLocaleDate()->formatDate(new \DateTime('now + 1 day'), \IntlDateFormatter::MEDIUM) ?>" id="datumodesl" name="datumodesl"/><img style="cursor:pointer" title="<?php echo __('Calendar'); ?>" id="date_select_trig" class="v-middle" alt="" src="<?php echo $block->getSkinUrl("images/grid-cal.gif");?> "/>&nbsp;&nbsp;&nbsp;&nbsp;<label for="date"><?php echo __('Time: '); ?></label><select name="datumodesl_hour" class="admin__control-select"><?php for($hour=1;$hour<=24;$hour++): ?><option value="<?php echo $hour; ?>" <?php echo (($_x = $block->getRequest()->getParam('datumodesl_hour')) ? $_x : 9 ) == $hour ? 'selected' : ''; ?>><?php printf('%02d', $hour); ?></option><?php endfor; ?></select>:<select name="datumodesl_min" class="admin__control-select"><?php for($min=0;$min<=59;$min++): ?><option value="<?php echo $min; ?>" <?php echo $block->getRequest()->getParam('datumodesl_min') == $min ? 'selected' : ''; ?>><?php printf('%02d', $min); ?></option><?php endfor; ?></select><script type="text/javascript">//<![CDATA[
function sendlaterx(obj) {require(['jquery'], function($) {if ($(obj).prop('checked') == true) {$('#sendlater-form').show();} else {$('#sendlater-form').hide();}});}require(['jquery','mage/calendar'], function($) {$(document).ready(function () {sendlaterx($('#sendlater'));});$('#datumodesl').calendar({dateFormat: '<?php echo $block->getLocaleDate()->getDateFormat(\IntlDateFormatter::MEDIUM); ?>',minDate: new Date(),hideIfNoPrevNext: true});});
//]]></script><div class="margin-form" style="padding: 5px 0 0 0"><label for="datereal"><?php echo __('Your time: '); ?></label><?php $date = $block->getLocaleDate()->formatDateTime(new \DateTime('now'), \IntlDateFormatter::MEDIUM); ?><select id="datereal" name="datereal" class="admin__control-select"><option value="-1" <?php echo $block->getRequest()->getParam('datereal') == -1 ? 'selected' : ''; ?>><?php echo $date; ?> -<?php echo __('1hr'); ?></option><option value="0" <?php echo $block->getRequest()->getParam('datereal', 0) == 0 ? 'selected' : ''; ?>><?php echo $date; ?></option><option value="1" <?php echo $block->getRequest()->getParam('datereal') == 1 ? 'selected' : ''; ?>><?php echo $date; ?> +<?php echo __('1hr'); ?></option></select>&nbsp;&nbsp;&nbsp;&nbsp;(<?php echo __('time zone: '); ?><span style="cursor:help;" title="<?php echo __('time zone settings'); ?>"><a href="<?php echo $block->getUrl('adminhtml/system_config/edit/section/general/', array('_fragment' => 'general_locale-head')); ?>" target="_blank"><?php echo $block->getTimezone()->getConfigTimezone(); ?></a></span>)</div></div></div><div class="clear" style="clear:both"></div><div style="float:left;margin-right:30px;width:100%"><span style="font-size:10px;"><?php echo __('Possible variables:'); ?><br /><div class="translate_notice"><?php echo $block->getNotice(); ?></div></span><div class="clear"></div><div class="coupons" style="margin-top: 5px"><?php echo __('Select coupon'); ?>:<select id="coupon" name="coupon" class="admin__control-select validate-coupon" onchange="couponSelect(this)"><?php foreach($block->getCoupons() as $coupon): ?><option value="<?php echo $coupon['rule_id']; ?>" <?php echo $block->getRequest()->getParam('coupon')==$coupon['rule_id']?'selected':'' ?>><?php echo $coupon['name']; ?></option><?php endforeach; ?></select><a href="<?php echo $block->getUrl('sales_rule/promo_quote/new/'); ?>"><?php echo __('Create coupon'); ?></a><div class="clear"></div><span style="display:none;" id="coupon_notice"><div class="translate_notice"><?php echo $block->getCouponsNotice(); ?></div></span></div></div><div class="margin-form" style="margin-top:50px"><?php if ($block->profile->user->getSimulatesms()) { echo __('Simulate SMS sending:');} ?><button id="submitLogin" onclick="return confirm('<?php echo __('Send').' '.__('SMS').'?'; ?>');" name="submitSend" title="<?php echo $block->escapeHtml(__('Send')); ?>" type="submit" class="primary" role="button" aria-disabled="false"><span class="ui-button-text"><span><?php echo $block->escapeHtml(__('Send')); ?></span></span></button></div></form></fieldset></div><script type="text/javascript">//<![CDATA[
countitSMS = new countitSMS(document.getElementById('textfake'), document.getElementById('unicode'), document.getElementById('labelSMS'));countitSMS.chartext1 = '<?php echo __('Characters: '); ?>';countitSMS.chartext2 = '<?php echo __('total sms: '); ?>';countitSMS.alert = '';countitSMS.translate = {<?php echo $block->getTranslate(); ?>};countitSMS.copyFrom = document.getElementById('text');countitSMS.marketingCustomers = '<?php echo __('Total customers:'); ?>';countitSMS.marketingTotal = '<?php echo __('Total SMS:'); ?>';require(['jquery','jquery/ui','jquery/validate'], function($) {$('#text').keyup(function () {countitSMS.count();});countitSMS.count();$.validator.addMethod('validate-coupon-variable', function (v) {return v.indexOf('{coupon_') === -1 || v.indexOf('{coupon_') !== -1 && $('#coupon').val();}, '<?php echo __('Coupon is not selected!'); ?>');$.validator.addMethod('validate-coupon', function (v) {return !v || v && $('#text').val().indexOf('{coupon_') !== -1;}, '<?php echo __('The coupon is selected but not used.'); ?>');$(document).ready(function () {countitSMS.marketingCount = '<?php echo $block->getCollection()->count(); ?>';countitSMS.count();countitSMS.help(document.getElementsByClassName('translate_notice'));})});function couponSelect(obj) {var style = document.getElementById('coupon_notice').style;if (obj.value) {style.display = 'block';} else {style.display = 'none';}}
//]]></script></div>