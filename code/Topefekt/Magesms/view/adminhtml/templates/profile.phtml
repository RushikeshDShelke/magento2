<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2017 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $block->profile->user; ?><?php $lang = $block->profile->lang; ?><script type="text/javascript">//<![CDATA[
require(['jquery'], function($) {$(document).load(function() {var gridData = document.getElementById('magesms-profile');var tr_array = gridData.getElementsByTagName('tr');for (var i = 0, len = tr_array.length; i < len; i++) {if (tr_array[i].className.indexOf('hover') !== -1) {tr_array[i].onmouseover = function () {this.className = this.className + ' on-mouse';};tr_array[i].onmouseout = function () {this.className = this.className.replace(' on-mouse', '');};tr_array[i].onclick = function () {var arr = this.id.split('_');var next = document.getElementById('histd_' + arr[1]);if (next.style.display == 'none') {next.style.display = 'table-row';} else {next.style.display = 'none';}var img = this.getElementsByClassName('img');if (img[0].style.display == 'none') {img[0].style.display = 'inline';} else {img[0].style.display = 'none';}if (img[1].style.display == 'none') {img[1].style.display = 'inline';} else {img[1].style.display = 'none';}};}}});});
//]]></script><div id="magesms-profile"><div class="messages"></div><div class="float-right"><?php if (!$user->getUser()): ?><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminEmployees.gif'); ?>" alt="" /> <?php echo $block->escapeHtml(__('Sign in')); ?></h4></div><fieldset class="fieldset "><form id="magesms_login" data-mage-init='{"validation": {}}' action="<?php echo $block->getUrl('*/*/login') ?>" method="post"><?php echo $block->getBlockHtml('formkey');?><p><?php echo $block->escapeHtml(__('If You already have an account, please sign in.')); ?></p><div><div class="margin-form"><label class="form-required" for="username"><?php echo $block->escapeHtml(__('Username:')); ?> <span class="required">*</span></label><input class="required-entry admin__control-text" type="text" name="username" id="username" value="" /></div><div class="margin-form"><label class="form-required" for="password"><?php echo $block->escapeHtml(__('Password:')); ?> <span class="required">*</span></label><input class="required-entry admin__control-text" type="password" name="password" id="password" value="" /></div><div class="margin-form"><button id="submitLogin" title="<?php echo $block->escapeHtml(__('Log in')); ?>" type="submit" class="primary" role="button" aria-disabled="false"><span class="ui-button-text"><span><?php echo $block->escapeHtml(__('Log in')); ?></span></span></button></div><div><span class="require">*</span> <?php echo $block->escapeHtml(__('Required field')); ?></div></div></form></fieldset></div><?php else: ?><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminEmployees.gif'); ?>" alt="" /> <?php echo $block->escapeHtml(__('User account info')); ?></h4></div><fieldset class="fieldset"><div><div class="margin-form"><label class="form-required"><?php echo $block->escapeHtml(__('Username:')); ?></label><span><?php echo $user->getUser(); ?></span></div><div class="margin-form"><label class="form-required"><?php echo $block->escapeHtml(__('Password:')); ?></label><span><?php echo $user->getPasswd(); ?></span></div><div class="margin-form"><label class="form-required"><?php echo $block->escapeHtml(__('SMS Credit:')); ?></label><span><?php echo $this->profile->credit; ?></span></div></div></fieldset></div><div class="entry-edit"><?php $admins = $block->profile->admins; ?><?php if ($adminedit = $block->getRequest()->getParam('adminedit')): ?><?php $edit = $admins->load($adminedit); ?><?php else: ?><?php $edit = $this->profile->getObjectManager()->create('Topefekt\Magesms\Model\Admins'); ?><?php endif; ?><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminEmployees.gif'); ?>" alt="" /> <?php echo $block->escapeHtml(__('Add administrators')); ?></h4></div><fieldset class="fieldset "><form id="magesms_admins" class="form" data-hasrequired="<?php echo __('* Required Fields') ?>" data-mage-init='{"validation": {"validationUrl": "<?php echo $block->getUrl('*/*/admin_validate'); ?>"}}' action="<?php echo $block->getUrl('*/*/admin_save'); ?>" method="post"><?php echo $block->getBlockHtml('formkey')?><div><div class="margin-form"><label class="form-required" for="name"><?php echo $block->escapeHtml(__('Name:')); ?> <span class="required">*</span></label><input class="required-entry admin__control-text" type="text" name="name" id="name" value="<?php echo $block->escapeHtml($edit->getName()); ?>" /></div><div class="margin-form"><label class="form-required" for="number"><?php echo $block->escapeHtml(__('Mobile number:')); ?> <span class="required">*</span></label><input class="required-entry admin__control-text validate-number" type="text" name="number" id="number" value="<?php echo $this->escapeHtml($edit->getNumber()); ?>" /><div><?php echo $block->escapeHtml(__('in international format, no leading zeros or a “+” sign, e.g., 447971796595')); ?></div></div><div class="margin-form"><input type="hidden" name="id" value="<?php echo $adminedit; ?>" /><button id="submitLogin" title="<?php echo $block->escapeHtml(__($adminedit ? 'Edit' : 'Add')); ?>" class="primary" role="button" aria-disabled="false"><span class="ui-button-text"><span><?php echo $block->escapeHtml(__($adminedit ? 'Edit' : 'Add')); ?></span></span></button></div><?php if ($admins->getCollection()->count()): ?><div class="grid"><table class="data-grid"><colgroup><col /><col /><col width="60" /><col width="60" /></colgroup><?php $even = 1; foreach( $admins->getCollection() as $_admins ): if ($even) $even = 0; else $even = 1; ?><tr class="hover <?php if (!$even) echo 'even'?> pointer"><td><?php echo $_admins->getName(); ?></td><td><?php echo $_admins->getNumber(); ?></td><td class="a-center"><a href="<?php echo $this->getUrl('*/*/*', array('adminedit' => $_admins->getId())) ?>" title="<?php echo $block->escapeHtml(__('EDIT administrator')); ?>"><?php echo $block->escapeHtml(__('edit')); ?></a></td><td class="a-center last"><a href="<?php echo $block->getUrl('*/*/admin_delete', array('id' => $_admins->getId())) ?>" title="<?php echo $block->escapeHtml(__('DELETE administrator')); ?>" onclick="return confirm('<?php echo $block->escapeHtml(__('Are you sure to delete')).' '.$_admins->getName().'?'; ?>')"><?php echo $block->escapeHtml(__('delete')); ?></a></td></tr><?php endforeach; ?></table></div><?php endif; ?><div><span class="require">*</span> <?php echo $block->escapeHtml(__('Required field')); ?></div></div></form></fieldset></div><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminEmployees.gif'); ?>" alt="" /> <?php echo $block->escapeHtml(__('Other settings')); ?></h4></div><fieldset class="fieldset "><form id="magesms_settings" data-mage-init='{"validation": {"validationUrl": "<?php echo $this->getUrl('*/*/setting_validate') ?>"}}' action="<?php echo $this->getUrl('*/*/setting_save') ?>" method="post"><?php echo $block->getBlockHtml('formkey');?><div class="fieldset"><div class="margin-form admin__field admin__field-option"><label for="simulatesms" class="admin__field-label"><?php echo $block->escapeHtml(__('Simulate SMS sending:')); ?></label><input type="checkbox" name="simulatesms" id="simulatesms" class="" value="1" <?php echo $user->getSimulatesms() ? 'checked' : ''; ?> /><span class="help" onclick="popup_title(this)" title="<?php echo $block->escapeHtml(__('Allows to test sending of SMS in modul and to view sent SMS in SMS history with a special status.')); ?>" style="cursor:help;text-decoration:underline;">?</span></div><div class="margin-form"><label for="URLreports"><?php echo $block->escapeHtml(__('Delivery reports:')); ?></label><input type="checkbox" name="URLreports" id="URLreports" value="1" <?php echo $user->getUrlreports() ? 'checked' : ''; ?> /><span class="help" onclick="popup_title(this)" title="<?php echo $block->escapeHtml(__('Allows to see delivery reports of SMS in SMS history Tab.')); ?>" style="cursor:help;text-decoration:underline;">?</span></div><div class="margin-form"><label for="pocetkredit"><?php echo $block->escapeHtml(__('Low credit alert:')); ?></label><input type="text" class="input-text admin__control-text" size="3" name="pocetkredit" id="pocetkredit" value="<?php echo $user->getPocetkredit() ? $user->getPocetkredit() : 0; ?>" /><span class="help" onclick="popup_title(this)" title="<?php echo $block->escapeHtml(__(' Allows to receive email when your SMS credit is low.')); ?>" style="cursor:help;text-decoration:underline;">?</span><span class="help2"><?php echo $block->escapeHtml(__('(0 = no alert)')); ?></span></div><div class="margin-form"><label for="deliveryemail"><?php echo $block->escapeHtml(__('Email for delivery reports:')); ?></label><input type="text" class="input-text validate-email admin__control-text" name="deliveryemail" id="deliveryemail" value="<?php echo $this->escapeHtml($user->getDeliveryemail()); ?>" /><span class="help" onclick="popup_title(this)" title="<?php echo $block->escapeHtml(__('Allows to receive email with delivery report of SMS.')); ?>" style="cursor:help;text-decoration:underline;">?</span></div><div class="margin-form"><label for="deliveryReportsErrorOnly"><?php echo $block->escapeHtml(__('Undelivered only:')); ?></label><input type="checkbox" name="deliveryReportsErrorOnly" id="deliveryReportsErrorOnly" value="1" <?php echo $user->getDeliveryReportsErrorOnly() ? 'checked' : ''; ?> /></div><div class="margin-form"><label style="width: 210px; margin: 0 20px 1em 0;"><?php echo $block->escapeHtml(__('For sending SMS prefer phone nr. from:')); ?></label><div style="white-space:nowrap"><input type="radio" class="input-text admin__control-radio" name="prefbilling" id="prefbilling0" value="0" <?php echo !$user->getPrefbilling() ? 'checked' : ''; ?> /><label for="prefbilling0" style="width: auto; display: inline;margin-right: 20px;"><?php echo $block->escapeHtml(__('invoice address')); ?></label></div><div style="white-space:nowrap"><input type="radio" class="input-text admin__control-radio" name="prefbilling" id="prefbilling1" value="1" <?php echo $user->getPrefbilling() ? 'checked' : ''; ?> /><label for="prefbilling1" style="width: auto; display: inline;"><?php echo $block->escapeHtml(__('delivery address')); ?></label></div><div class="clear"></div></div><div class="margin-form"><button id="submitLogin" title="<?php echo $block->escapeHtml(__('Save')); ?>" class="primary" role="button" aria-disabled="false"><span class="ui-button-text"><span><?php echo $block->escapeHtml(__('Save')); ?></span></span></button></div></div></form></fieldset></div><?php endif; ?></div><div class="float-left"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminEmployees.gif'); ?>" alt="" /> <?php echo $block->escapeHtml(__($user->getUser() ? 'Edit user account' : 'New user account')); ?></h4></div><fieldset class="fieldset "><form id="magesms_profil" data-mage-init='{"validation": {"validationUrl": "<?php echo $block->getUrl('*/*/validate') ?>"}}' action="<?php echo $this->getUrl('*/*/save') ?>" method="post"><?php echo $block->getBlockHtml('formkey');?><?php if (!$user->getUser()): ?><p><?php echo $block->escapeHtml(__('Not registered yet? Create account now!')); ?></p><?php endif; ?><div class="margin-form"><label class="form-required" for="email"><?php echo $block->escapeHtml(__('Email:')); ?> <span class="required">*</span></label><input class="required-entry admin__control-text validate-email" type="text" name="email" id="email" value="<?php echo $block->escapeHtml($user->getEmail()); ?>" /></div><div class="margin-form"><label class="form-required"><?php echo $block->escapeHtml(__('Registration type:')); ?></label><input type="radio" name="regtype" id="reg-type1" class="admin__control-radio" style="float: left" value="person" <?php echo !$user->getRegtype() || $user->getRegtype() =='person' ? 'checked' : ''; ?> /><label style="width: auto; margin: 0 15px 0 5px" for="reg-type1"><?php echo $block->escapeHtml(__('Personal')); ?></label><input type="radio" name="regtype" id="reg-type2" class="admin__control-radio" style="float: left" value="firm" <?php echo $user->getRegtype() =='firm' ? 'checked' : ''; ?> /><label style="width: auto; margin-left: 5px" for="reg-type2"><?php echo $block->escapeHtml(__('Business')); ?></label><div class="clearfix"></div></div><div class="fieldset-wrapper-title firm"><h4 class="fieldset-legend head-account"><?php echo $block->escapeHtml(__('Billing information')); ?></h4></div><div class="fieldset firm"><div class="margin-form"><label class="" for="companyname"><?php echo $block->escapeHtml(__('Company name:')); ?> <span class="required">*</span></label><input class="admin__control-text" type="text" name="companyname" id="companyname" value="<?php echo $block->escapeHtml($user->getCompanyname()); ?>" /></div><div class="margin-form firm czech" style="display: none;"><label for="companyid"><?php echo $block->escapeHtml(__('Company ID:')); ?></label><input class="admin__control-text" type="text" name="companyid" id="companyid" value="<?php echo $block->escapeHtml($user->getCompanyid()); ?>" /></div><div class="margin-form firm vat" style="display: none;"><label for="companyvat"><?php echo $block->escapeHtml(__('Company VAT:')); ?></label><input class="admin__control-text" type="text" name="companyvat" id="companyvat" value="<?php echo $block->escapeHtml($user->getCompanyvat()); ?>" /><span class="error" style="display: none"><?php echo $block->escapeHtml(__('Invalid VAT')); ?></span></div></div><div class="fieldset-wrapper-title"><h4 class="fieldset-legend head-account"><?php echo $block->escapeHtml(__('Contact person')); ?></h4></div><div class="fieldset "><div class="margin-form"><label for="firstname"><?php echo $block->escapeHtml(__('First name:')); ?></label><input class="admin__control-text" type="text" name="firstname" id="firstname" value="<?php echo $block->escapeHtml($user->getFirstname()); ?>" /></div><div class="margin-form"><label for="lastname"><?php echo $block->escapeHtml(__('Last name:')); ?></label><input class="admin__control-text" type="text" name="lastname" id="lastname" value="<?php echo $block->escapeHtml($user->getLastname()); ?>" /></div></div><div class="fieldset-wrapper-title"><h4 class="fieldset-legend head-account"><?php echo $block->escapeHtml(__('Address')); ?></h4></div><div class="fieldset "><div class="margin-form"><label for="addressstreet"><?php echo $block->escapeHtml(__('Street:')); ?></label><input class="admin__control-text" type="text" name="addressstreet" id="addressstreet" value="<?php echo $block->escapeHtml($user->getAddressstreet()); ?>" /></div><div class="margin-form"><label for="addresszip"><?php echo $block->escapeHtml(__('ZIP:')); ?></label><input class="admin__control-text" type="text" name="addresszip" id="addresszip" value="<?php echo $block->escapeHtml($user->getAddresszip()); ?>" /></div><div class="margin-form"><label for="addresscity"><?php echo $block->escapeHtml(__('City:')); ?></label><input class="admin__control-text" type="text" name="addresscity" id="addresscity" value="<?php echo $block->escapeHtml($user->getAddresscity()); ?>" /></div><div class="margin-form"><label for="country"><?php echo $block->escapeHtml(__('Country:')); ?></label><select name="country" id="country" class="admin__control-select" onchange="vatfield();"></select></div></div><?php if (!$user->getId()): ?><?php if (!$block->getMageHelper()->getConfig('default/referer')): ?><div class="margin-form"><label for="refererid"><?php echo $block->escapeHtml(__('Referer ID:')); ?></label><input class="admin__control-text" type="text" name="refererid" id="refererid" value="<?php echo $block->escapeHtml($user->getRefererid()); ?>" /></div><?php endif; ?><div class="margin-form"><?php $agree_url = $block->getViewFileUrl('Topefekt_Magesms::licence_'); if (in_array($block->getMageHelper()->getConfig('default/template/language'), array('cz', 'sk'))) $agree_url .= 'cz.pdf'; else $agree_url .= 'en.pdf'; ?><label class="form-required"><a href="<?php echo $agree_url; ?>"><?php echo $block->escapeHtml(__('View licence terms:')); ?></a></label><input type="radio" class="validate-agree admin__control-radio" name="agree" id="agree1" style="float: left" value="1" /><label style="width: auto; margin: 0 15px 0 5px" class="form-required" for="agree1"><?php echo $block->escapeHtml(__('I agree')); ?></label><input type="radio" name="agree" id="agree2" class="admin__control-radio" style="float: left" value="2" checked /><label style="width: auto; margin-left: 5px" for="agree2"><?php echo $block->escapeHtml(__('I dont agree')); ?></label><div class="clear"></div></div><?php endif; ?><div class="margin-form"><button id="submitLogin" title="<?php echo $block->escapeHtml(__($user->getId() ? 'Save' : 'Register')); ?>" class="primary" role="button" aria-disabled="false"><span class="ui-button-text"><span><?php echo $block->escapeHtml(__($user->getId() ? 'Save' : 'Register')); ?></span></span></button></div><div><span class="require">*</span> <?php echo $block->escapeHtml(__('Required field')); ?></div></form><script type="text/javascript">require(['jquery'], function($) {function changeProfile(elm) {var type = elm.target.value;$("#magesms-profile div[id^='advice-required-entry-']").each(function (el) {$(el).remove();});if (type == "firm") {$("#magesms-profile #companyname").addClass("required-entry");$("#magesms-profile label[for=companyname]").addClass("form-required");$('#magesms-profile .firm').show();vatfield();} else {$("#magesms-profile #companyname").removeClass("required-entry");$("#magesms-profile label[for=companyname]").removeClass("form-required");$('#magesms-profile .firm').hide();}}$(document).ready(function () {country = {<?php foreach( $block->profile->country as $country ): ?>"<?php echo $block->escapeHtml($country->getName()); ?>": <?php echo $country->getVat(); ?>,<?php endforeach; ?>};for (var name in country) {var option = document.createElement('option');option.value = name;option.text = name;if (name == "<?php echo $user->getCountry() ? $user->getCountry() : $lang; ?>") {option.selected = true;}$('#country').append(option);}$("#magesms-profile input[name=regtype]:checked")[0].click();$("#magesms-profile select#country").change(vatfield);$("#magesms-profile #companyvat").on('blur', vatcheck);vatfield();});function vatfield() {var selected = $("#magesms-profile select#country")[0].value;if (selected == "Czech Republic") {$("#magesms-profile div.czech").show();} else {$("#magesms-profile div.czech").hide();}if (country[selected] == 1) {$("#magesms-profile div.vat").show();} else {$("#magesms-profile div.vat").hide();}vatcheck();}function vatcheck() {if ($("#magesms-profile input[name=regtype]:checked")[0].value == "firm") {var selected = $("#magesms-profile select#country")[0].value;var vat = $("#magesms-profile #companyvat")[0].value;if (country[selected] && vat) {$.get("<?php echo $block->getUrl('*/*/vat') ?>", {country: selected, companyvat: vat}).done(function(data) {if (!data.error && data.valid) {$("#magesms-profile .vat input").removeClass('invalidvat').addClass('validvat');$("#magesms-profile .vat .error").hide();} else {$("#magesms-profile .vat input").addClass('invalidvat').removeClass('validvat');$("#magesms-profile .vat .error").show();}});}}}$("#reg-type1").on('click', changeProfile);$("#reg-type2").on('click', changeProfile);});</script></fieldset></div></div><div class="clear"></div><br /><br /><?php echo $block->getMagesmsAnalyze(); ?></div>