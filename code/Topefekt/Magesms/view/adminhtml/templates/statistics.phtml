<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2017 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $block->profile->user; $lang = $block->profile->lang; $type = [ 1 => __(' admin sms'), 2 => __(' customer sms'), 3 => __(' marketing sms'), 4 => __(' simple sms') ]; ?><div id="magesms"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminTools.gif'); ?>" alt="" /> <?php echo __('Statistics'); ?></h4></div><fieldset class="fieldset grid"><form id="magesms_filter" action="<?php echo $block->getUrl('*/*/') ?>" method="post"><?php echo $block->getBlockHtml('formkey') ?><div class="margin-form" style="text-align: center"><label for="datefrom"><?php echo __('Date from:'); ?></label><input type="text" style="width: 100px;" class="input-text admin__control-text" value="<?php echo $block->getRequest()->getParam('datefrom') ? $block->getRequest()->getParam('datefrom') : $block->getLocaleDate()->formatDate(new \DateTime()); ?>" id="datefrom" name="datefrom"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label for="dateto"><?php echo __('to: '); ?></label><input type="text" style="width: 100px;" class="input-text admin__control-text" value="<?php echo $block->getRequest()->getParam('dateto') ? $block->getRequest()->getParam('dateto') : $block->getLocaleDate()->formatDate(new \DateTime()); ?>" id="dateto" name="dateto"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select name="status" id="status" class="admin__control-select"><option value=""><?php echo __('Status'); ?></option><?php foreach( $block->getSms()->status() as $id=>$stat ): ?><option value="<?php echo $id; ?>" <?php echo $id == $block->getFilterData('status') ? 'selected' : ''; ?>><?php echo $stat->getName(); ?></option><?php endforeach; ?></select><input type="hidden" name="eshopsms1" value="0" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="eshopsms1" id="eshopsms1" class="admin__control-checkbox" value="1" <?php echo $block->getRequest()->getParam('eshopsms1') == null || $block->getRequest()->getParam('eshopsms1') == 1 ? 'checked' : ''; ?> /><label for="eshopsms1"><?php echo __(' admin sms'); ?></label><input type="hidden" name="eshopsms" value="0" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="eshopsms" id="eshopsms" class="admin__control-checkbox" value="1" <?php echo $block->getRequest()->getParam('eshopsms') == null || $block->getRequest()->getParam('eshopsms') == 1 ? 'checked' : ''; ?> /><label for="eshopsms"><?php echo __(' customer sms'); ?></label><input type="hidden" name="bulksms" value="0" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="bulksms" id="bulksms" class="admin__control-checkbox" value="1" <?php echo $block->getRequest()->getParam('bulksms') == null || $block->getRequest()->getParam('bulksms') == 1 ? 'checked' : ''; ?> /><label for="bulksms"><?php echo __(' marketing sms'); ?></label><input type="hidden" name="bulksms2" value="0" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="bulksms2" id="bulksms2" class="admin__control-checkbox" value="1" <?php echo $block->getRequest()->getParam('bulksms2') == null || $block->getRequest()->getParam('bulksms2') == 1 ? 'checked' : ''; ?> /><label for="bulksms2"><?php echo __(' simple sms'); ?></label><button id="submit" name="submit" title="<?php echo $block->escapeHtml(__('Show')); ?>" type="submit" class="primary" role="button" aria-disabled="false"><span class="ui-button-text"><span><?php echo $block->escapeHtml(__('Show')); ?></span></span></button></div><script type="text/javascript">//<![CDATA[
require(['jquery','mage/calendar'], function($) {$('#datefrom').calendar();$('#dateto').calendar();});
//]]></script></form></fieldset></div><?php $history = $block->getCollection(); $count = $history->getSize(); if ($count): $output = array('status' => array(), 'type' => array()); foreach($history as $_obj) { if (!isset($output['type'][$_obj->getType()])) $output['type'][$_obj->getType()] = 0; $output['type'][$_obj->getType()]++; if ($_obj->getStatus() != \Topefekt\Magesms\Model\Sms::ERROR) { if (!isset($output['status'][(string)$block->getSms()->status($_obj->getStatus())->getName()])) $output['status'][(string)$block->getSms()->status($_obj->getStatus())->getName()] = 0; $output['status'][(string)$block->getSms()->status($_obj->getStatus())->getName()]++; } else { if (!isset($output['status'][(string)$block->getSms()->status($_obj->getStatus())->getName().' - '.$_obj->getNote()])) $output['status'][(string)$block->getSms()->status($_obj->getStatus())->getName().' - '.$_obj->getNote()] = 0; $output['status'][(string)$block->getSms()->status($_obj->getStatus())->getName().' - '.$_obj->getNote()]++; } } ?><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminCatalog.gif'); ?>" alt="" /><?php echo __('Total sms:').' '.$count; ?></h4></div><fieldset class="fieldset grid"><script type="text/javascript" src="https://www.google.com/jsapi"></script><script type="text/javascript">google.load("visualization", "1", {packages:["corechart"]});google.setOnLoadCallback(drawChart);function drawChart() {var dataStatus = google.visualization.arrayToDataTable([['SMS', 'Count'],<?php foreach($output['status'] as $key=>$val): ?>['<?php echo $key; ?>', <?php echo $val; ?>],<?php endforeach; ?>]);var optionsStatus = {title: '<?php echo __('Status'); ?>',backgroundColor: '#fdfdfd',pieSliceText: 'value',};var chartStatus = new google.visualization.PieChart(document.getElementById('Status'));chartStatus.draw(dataStatus, optionsStatus);var dataType = google.visualization.arrayToDataTable([['SMS', 'Count'],<?php foreach($output['type'] as $key=>$val): ?>['<?php echo $type[$key]; ?>', <?php echo $val; ?>],<?php endforeach; ?>]);var optionsType = {title: '<?php echo __('Type'); ?>',backgroundColor: '#fdfdfd',pieSliceText: 'value',};var chartType = new google.visualization.PieChart(document.getElementById('Type'));chartType.draw(dataType, optionsType);}</script><div id="Type" style="width: 49%; min-width: 630px; height: 400px; display: inline-block;"></div><div id="Status" style="width: 49%; min-width: 630px; height: 400px; display: inline-block;"></div></fieldset></div><?php else: ?><div><?php echo __('Total SMS: 0'); ?></div><?php endif; ?></div>