<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2017 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $block->profile->user; $lang = $block->profile->lang; ?><p><?php echo __('Send SMS or bulk SMS. Enter mobile numbers or upload CSV file.'); ?></p><div id="magesms"><div class="messages"></div><form name="formSMS" id="magesms_sendsms" data-mage-init='{"validation": {"validationUrl": "<?php echo $block->getUrl('*/*/validate'); ?>"}}' action="<?php echo $block->getUrl('*/*/') ?>" enctype="multipart/form-data" method="post"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminTools.gif'); ?>" alt="" /> <?php echo __('Bulk SMS text'); ?></h4><!--<span class="right"><a href="<?php echo $block->getUrl('*/*/template_save'); ?>" title="<?php echo __('Save template'); ?>" onclick="showPopup(this);return false;">[<?php echo __('Save template'); ?>]</a>&nbsp;&nbsp;&nbsp;<a href="<?php echo $block->getUrl('*/*/template_load'); ?>" title="<?php echo __('Saved Templates'); ?>" onclick="showPopup(this);return false;">[<?php echo __('Saved Templates'); ?>]</a></span>--></div><fieldset class="fieldset"><?php echo $block->getBlockHtml('formkey') ?><div style="float: left;margin-right:30px;width:450px"><label for="text"><?php echo __('Enter SMS text'); ?></label><br /><div class="margin-form"><textarea name="text" id="text" class="required-entry input-text admin__control-textarea" style="width:420px; height:135px;"><?php echo $block->getRequest()->getParam('text'); ?></textarea></div><div class="clear"></div><span style="font-size:10px;"><?php echo __('Possible variables:'); ?><br /></span><?php echo $block->getSelectStore(); ?><span style="font-size:10px;"><div id="notice"><?php echo $block->getNotice(); ?></div></span></div><div style="float: left;margin-right:30px;"><label for="text"><?php echo __('Preview'); ?> (<span id="labelSMS"></span>)</label><br /><div class="margin-form"><textarea name="textfake" id="textfake" disabled="disabled" class="required-entry input-text admin__control-textarea" style="width:420px; height:135px;border:1px solid grey;"></textarea></div></div><div style="float: left;margin-top:1.5em;"><div class="margin-form"><input id="unicode" type="checkbox" value="1" name="unicode" <?php echo $block->getRequest()->getParam('unicode') ? 'checked' : ''; ?> /><label for="unicode"><?php echo __(' Unicode '); ?></label><span style="cursor:help;text-decoration:underline;" title="<?php echo __('Check only if you want to use Chinese, Arabic, Greek, Hebrew, Korean, Cyrillic, etc. or diacritic in the text of your SMS message (Unicode text allows you to insert characters in all fonts and various other symbols simultaneously. Number of characters in one SMS will be reduced to 70).'); ?>" onclick="popup_title(this)">?</span></div><div class="margin-form"><input type="hidden" value="0" name="unique" /><input id="unique" type="checkbox" value="1" name="unique" <?php echo $block->getRequest()->getParam('unique') === '0' ? '' : 'checked'; ?> /><label for="unique"><?php echo __('Remove duplicate numbers'); ?></label></div><div class="margin-form" style="margin-top: 10px"><input id="sendlater" type="checkbox" value="1" onchange="sendlaterx(this)" name="sendlater" <?php echo $block->getRequest()->getParam('sendlater') ? 'checked' : ''; ?> /><label for="sendlater"><?php echo __(' Send later '); ?></label></div><div class="margin-form sendlater-form" id="sendlater-form" style="display: none; padding: 5px 0 0 20px"><label for="date"><?php echo __('Date:'); ?></label><input type="text" style="width: 130px;" class="input-text validate-sendlater-datumodesl admin__control-text" value="<?php echo $block->getLocaleDate()->formatDate(new \DateTime('now + 1 day'), \IntlDateFormatter::MEDIUM) ?>" id="datumodesl" name="datumodesl"/><img style="cursor:pointer" title="<?php echo __('Calendar'); ?>" id="date_select_trig" class="v-middle" alt="" src="<?php echo $block->getSkinUrl("images/grid-cal.gif");?> "/>&nbsp;&nbsp;&nbsp;&nbsp;<label for="date"><?php echo __('Time: '); ?></label><select name="datumodesl_hour" class="admin__control-select"><?php for($hour=1;$hour<=24;$hour++): ?><option value="<?php echo $hour; ?>" <?php echo $block->getRequest()->getParam('datumodesl_hour', 9) == $hour ? 'selected' : ''; ?>><?php printf('%02d', $hour); ?></option><?php endfor; ?></select>:<select name="datumodesl_min" class="admin__control-select"><?php for($min=0;$min<=59;$min++): ?><option value="<?php echo $min; ?>" <?php echo $block->getRequest()->getParam('datumodesl_min', 00) == $min ? 'selected' : ''; ?>><?php printf('%02d', $min); ?></option><?php endfor; ?></select><script type="text/javascript">//<![CDATA[
function sendlaterx(obj) {require(['jquery'], function($) {if ($(obj).prop('checked') == true) {$('#sendlater-form').show();} else {$('#sendlater-form').hide();}});}require(['jquery','mage/calendar'], function($) {$(document).ready(function () {sendlaterx($('#sendlater'));});$('#datumodesl').calendar({dateFormat: '<?php echo $block->getLocaleDate()->getDateFormat(\IntlDateFormatter::MEDIUM); ?>',minDate: new Date(),hideIfNoPrevNext: true});});
//]]></script><div class="margin-form" style="padding: 5px 0 0 0"><label for="datereal"><?php echo __('Your time: '); ?></label><?php $date = $block->getLocaleDate()->formatDateTime(new \DateTime('now'), \IntlDateFormatter::MEDIUM); ?><select id="datereal" name="datereal" class="admin__control-select"><option value="-1" <?php echo $block->getRequest()->getParam('datereal') == -1 ? 'selected' : ''; ?>><?php echo $date; ?> -<?php echo __('1hr'); ?></option><option value="0" <?php echo $block->getRequest()->getParam('datereal', 0) == 0 ? 'selected' : ''; ?>><?php echo $date; ?></option><option value="1" <?php echo $block->getRequest()->getParam('datereal') == 1 ? 'selected' : ''; ?>><?php echo $date; ?> +<?php echo __('1hr'); ?></option></select>&nbsp;&nbsp;&nbsp;&nbsp;(<?php echo __('time zone: '); ?><span style="cursor:help;" title="<?php echo __('time zone settings'); ?>"><a href="<?php echo $block->getUrl('adminhtml/system_config/edit/section/general/', array('_fragment' => 'general_locale-head')); ?>" target="_blank"><?php echo $block->getTimezone()->getConfigTimezone(); ?></a></span>)</div></div></div></fieldset></div><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminEmployees.gif'); ?>" alt="" /><?php echo __('Add recipients '); ?><span style="cursor:help;text-decoration:underline;" title="<?php echo __('Add one or more recipients separated by commas. Number must be in international format, no leading zeros or “+“ sign.'); ?>">?</span>&nbsp;<?php echo __(' (e.g. 447971796595)'); ?></h4></div><fieldset class="fieldset"><div style="float: left;margin-right: 30px;"><div class="margin-form"><textarea id="recipients" name="recipients" data-validate='{ "validate-recipients-file":true}' class="input-text admin__control-textarea" style="width:420px; height:150px;"><?php echo $block->getRequest()->getParam('recipients'); ?></textarea></div></div><div style="float: left;"><div class="margin-form"><?php echo __('Add recipients in CSV(.csv, .txt) or vCARD(.vcf)'); ?><span style="cursor:help;text-decoration:underline;" title="<?php echo __('CSV file - 1 column, 1st column - number (Number must be in international format, no leading zeros or “+“ sign; e.g. 447971796595)'); ?>">?</span><br /><input type="file" id="sms_file" name="sms_file" /></div><!--<div id="add_recipient"><?php $_alphabet = __('lang_alphabet'); $alphabet = explode(';', $_alphabet); if ($alphabet[0] == 'lang_alphabet') { $alphabet = range('A', 'Z'); } ?><a href="#" onclick="alphabet.toggle(); alphabet.load('<?php echo $alphabet[0]; ?>'); return false;"><img src="<?php echo $block->getViewFileUrl('Topefekt_Magesms::images/AdminEmployees.gif'); ?>" alt="" /> <?php echo __('Add recipients '); ?></a><div style="display:none;" id="recipient-popup"><div class="popup-close" onclick="alphabet.toggle()">X</div><div class="popup-alphabet"><?php foreach ($alphabet as $char): ?><a href="#" title="<?php echo $char; ?>" onclick="return alphabet.load('<?php echo $char; ?>')"><?php echo $char; ?></a><?php endforeach; ?></div><div id="popup-output"></div></div></div>--></div><div class="clear"></div><script type="text/javascript">//<![CDATA[
alphabet = new magesmsAddRecipient(document.getElementById('recipient-popup'), document.getElementById('popup-output'), document.getElementById('recipients'));alphabet.setServiceUrl('<?php echo $block->getUrl('*/*/customers_load') ?>');alphabet.setTranslate({notfound: '<?php echo __('not found'); ?>'});
//]]></script></fieldset><div class="clear"></div><div class="margin-form" style="margin-left:500px"><?php if ($block->profile->user->getSimulatesms()) { echo __('Simulate SMS sending:');} ?><button id="submitLogin" onclick="return confirm('<?php echo __('Send').' '.__('SMS').'?'; ?>');" name="submitSend" title="<?php echo $block->escapeHtml(__('Send')); ?>" type="submit" class="primary" role="button" aria-disabled="false"><span class="ui-button-text"><span><?php echo $block->escapeHtml(__('Send')); ?></span></span></button></div></div></form><script type="text/javascript">//<![CDATA[
countitSMS = new countitSMS(document.getElementById('textfake'), document.getElementById('unicode'), document.getElementById('labelSMS'));countitSMS.chartext1 = '<?php echo __('Characters: '); ?>';countitSMS.chartext2 = '<?php echo __('SMS: '); ?>';countitSMS.translate = {<?php echo $block->getTranslate(); ?>};countitSMS.copyFrom = document.getElementById('text');countitSMS.alert = '<?php echo __('Text is too long'); ?>';countitSMS.count();require(['jquery','jquery/ui','jquery/validate'], function($) {$('#text').keyup(function () {countitSMS.count();});countitSMS.count();countitSMS.help($('#notice'));$.validator.addMethod('validate-recipients-file', function (v) {return $('#sms_file').val() || v;}, '<?php echo __('Recipients found: 0'); ?>');});
//]]></script></div>