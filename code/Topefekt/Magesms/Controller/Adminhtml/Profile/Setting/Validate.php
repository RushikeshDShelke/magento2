<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2017 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
 namespace Topefekt\Magesms\Controller\Adminhtml\Profile\Setting; use Magento\Backend\App\Action\Context; use Magento\Framework\DataObject; use Magento\Framework\Registry; use Magento\Framework\View\Result\PageFactory; use Magento\Framework\Controller\Result\JsonFactory; use Topefekt\Magesms\Helper\Data; use Topefekt\Magesms\Model\Api; use Topefekt\Magesms\Model\Smsprofile; class Validate extends \Topefekt\Magesms\Controller\Adminhtml\Action { protected $resultJsonFactory; public function __construct(Context $i31cc913adc2717e2346d503153c97449098831aa, PageFactory $i3f1db03e4dfdd28ff5ba1a1f709c3a2e135b99b1, Smsprofile $i6abff7c4dab2aa28578ae1dc49699ba6b1d18c18, Api $i451f679eaafeecb81387b150019f0d9e0fa83d16, Data $i0d09b2a4f282150bf47b02f9f3d82586fe313844, Registry $ie9fe5cdc9fc7093987f4d41ad4cae3554e64e17b, JsonFactory $i9a280ebe4bf63f298222a5d64da69db4e648d487) { parent::__construct($i31cc913adc2717e2346d503153c97449098831aa, $i3f1db03e4dfdd28ff5ba1a1f709c3a2e135b99b1, $i6abff7c4dab2aa28578ae1dc49699ba6b1d18c18, $i451f679eaafeecb81387b150019f0d9e0fa83d16, $i0d09b2a4f282150bf47b02f9f3d82586fe313844, $ie9fe5cdc9fc7093987f4d41ad4cae3554e64e17b); $this->resultJsonFactory = $i9a280ebe4bf63f298222a5d64da69db4e648d487; } public function execute() { $ia1a238c1f12f3901520c7ca55efa646e471f7f6e = new DataObject(); $ia1a238c1f12f3901520c7ca55efa646e471f7f6e->setError(false); if (!$this->getRequest()->getPost()){ $ia1a238c1f12f3901520c7ca55efa646e471f7f6e->setError(true); return $this->resultJsonFactory->create()->setData($ia1a238c1f12f3901520c7ca55efa646e471f7f6e); } $iacbd1c78463510856e506611fe14b5e1173581a6 = $this->getRequest(); $this->profile->user->setSimulatesms((int)$iacbd1c78463510856e506611fe14b5e1173581a6->getPost('simulatesms', 0)); $this->profile->user->setUrlreports((int)$iacbd1c78463510856e506611fe14b5e1173581a6->getPost('URLreports', 0)); $this->profile->user->setPocetkredit((int)$iacbd1c78463510856e506611fe14b5e1173581a6->getPost('pocetkredit', 0)); $this->profile->user->setDeliveryemail($iacbd1c78463510856e506611fe14b5e1173581a6->getPost('deliveryemail', '')); $this->profile->user->setPrefbilling($iacbd1c78463510856e506611fe14b5e1173581a6->getPost('prefbilling', 0)); $this->profile->user->setDeliveryReportsErrorOnly($iacbd1c78463510856e506611fe14b5e1173581a6->getPost('deliveryReportsErrorOnly', 0)); $ie2d3c964f264968835c26fc02ee0d5f0820fe0ce = ''; if ($this->profile->user->getUrlreports()) $ie2d3c964f264968835c26fc02ee0d5f0820fe0ce = $this->_url->getBaseUrl().'magesms/delivery'; $ibdd27a8dd714410289189d318feb96fe6ed8e07f = $this->profile->user->validate(); if (is_array($ibdd27a8dd714410289189d318feb96fe6ed8e07f)) { $ia1a238c1f12f3901520c7ca55efa646e471f7f6e->setError(true); $ia1a238c1f12f3901520c7ca55efa646e471f7f6e->setMessage(implode(' ', $ibdd27a8dd714410289189d318feb96fe6ed8e07f)); return $this->resultJsonFactory->create()->setData($ia1a238c1f12f3901520c7ca55efa646e471f7f6e); } $ia61712c27ea241bd7a543dc2b02ea572274d0322 = 'action=edit2&username='.urlencode($this->profile->user->getUser()). '&password='.urlencode($this->profile->user->getPasswd()). '&shop_domain='.urlencode($ie2d3c964f264968835c26fc02ee0d5f0820fe0ce). '&pocetkredit='.urlencode($this->profile->user->getPocetkredit()). '&email='.urlencode($this->profile->user->getDeliveryemail()). '&delivery_reports_error_only='.urlencode($this->profile->user->getDeliveryReportsErrorOnly()). '&newdlr=1'; $i55dd4e7042a1f9031b84f07f04c37165ce3d0720 = $this->_api->serverPost($ia61712c27ea241bd7a543dc2b02ea572274d0322); if ($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['errno'] != 99 || !empty($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['data'])) { if ($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['errno'] == 1 || $i55dd4e7042a1f9031b84f07f04c37165ce3d0720['errno'] == 5) { $this->getMessageManager()->addSuccessMessage(__('Account was changed.')); } elseif ($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['errno'] == 11) { $this->getMessageManager()->addSuccessMessage(__('Account was changed, but module URL for DR does not answer.')); $this->profile->user->setUrlreports(0); } elseif ($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['errno'] == 3) { $if3b1e2c1706de4c1bca112c669caba3a0420b880 = __('error'); } elseif ($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['errno'] == 4) { $if3b1e2c1706de4c1bca112c669caba3a0420b880 = __('you can change account after ').$i55dd4e7042a1f9031b84f07f04c37165ce3d0720['error'].__(' seconds'); } } else { $if3b1e2c1706de4c1bca112c669caba3a0420b880 = __('error'); } if (!empty($if3b1e2c1706de4c1bca112c669caba3a0420b880) && is_array($ibdd27a8dd714410289189d318feb96fe6ed8e07f) && count($ibdd27a8dd714410289189d318feb96fe6ed8e07f)) { $ibdd27a8dd714410289189d318feb96fe6ed8e07f[] = $if3b1e2c1706de4c1bca112c669caba3a0420b880; } elseif (!empty($if3b1e2c1706de4c1bca112c669caba3a0420b880)) { $ibdd27a8dd714410289189d318feb96fe6ed8e07f = [$if3b1e2c1706de4c1bca112c669caba3a0420b880]; } if (is_array($ibdd27a8dd714410289189d318feb96fe6ed8e07f) && count($ibdd27a8dd714410289189d318feb96fe6ed8e07f)) { $ia1a238c1f12f3901520c7ca55efa646e471f7f6e->setError(true); $ia1a238c1f12f3901520c7ca55efa646e471f7f6e->setMessage(implode(' ', $ibdd27a8dd714410289189d318feb96fe6ed8e07f)); } else { $this->profile->user->save(); } return $this->resultJsonFactory->create()->setData($ia1a238c1f12f3901520c7ca55efa646e471f7f6e); } protected function _isAllowed() { return $this->_authorization->isAllowed('Topefekt_Magesms::magesms_profile'); } } 