<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2017 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
 namespace Topefekt\Magesms\Model; class Routes extends \Magento\Framework\Model\AbstractModel { const SENDER_TEXT = 0; const SENDER_SYSTEM = 1; const SENDER_OWN = 2; const SENDER_SIM = 3; const SENDER_SHORTCODE = 4; public $displayCode = false; protected $profile; protected $api; protected $alternative; public function __construct(\Magento\Framework\Model\Context $i31cc913adc2717e2346d503153c97449098831aa, \Magento\Framework\Registry $ie9fe5cdc9fc7093987f4d41ad4cae3554e64e17b, Smsprofile $i3a81d7d700dc6d1b4279ed33db8d01cd2cae8ed9, Api $i451f679eaafeecb81387b150019f0d9e0fa83d16, Routes\Alternative $ida3b491904fb073f446bf820cd55a0ff69b347d1, ResourceModel\Routes $ie1939956d7f2b426b1f98ab49f12f1d271da85c2 = null, ResourceModel\Routes\Collection $ib0dfcb3a2fe0ac5af091a318af6a161d665cc0cd = null, array $ia61712c27ea241bd7a543dc2b02ea572274d0322 = []) { $this->profile = $i3a81d7d700dc6d1b4279ed33db8d01cd2cae8ed9; $this->api = $i451f679eaafeecb81387b150019f0d9e0fa83d16; $this->alternative = $ida3b491904fb073f446bf820cd55a0ff69b347d1; parent::__construct($i31cc913adc2717e2346d503153c97449098831aa, $ie9fe5cdc9fc7093987f4d41ad4cae3554e64e17b, $ie1939956d7f2b426b1f98ab49f12f1d271da85c2, $ib0dfcb3a2fe0ac5af091a318af6a161d665cc0cd, $ia61712c27ea241bd7a543dc2b02ea572274d0322); } protected function _construct() { $this->_init(\Topefekt\Magesms\Model\ResourceModel\Routes::class); } public function loadData($i30f20aafde612a957f7f966cb5b85e35782bc88a) { $i5528ed14b056e3debe4695094269de3a98f76fe7 = []; $ie8b7b1b62dc29a284d794c9f11a8ee2ea7472eec = $this->getCollection()->addFieldToFilter('type', $i30f20aafde612a957f7f966cb5b85e35782bc88a); foreach ($ie8b7b1b62dc29a284d794c9f11a8ee2ea7472eec as $ice10b700e3771fcda63608142bce93b608228583) { $i9bd2c88ca2206122845c5e189e2b6856a2409e3a = $this->alternative->getCollection()->addFieldToFilter('route_id', $ice10b700e3771fcda63608142bce93b608228583->getId()); if ($i9bd2c88ca2206122845c5e189e2b6856a2409e3a->count()) $ice10b700e3771fcda63608142bce93b608228583->setAlternatives($i9bd2c88ca2206122845c5e189e2b6856a2409e3a); $i5528ed14b056e3debe4695094269de3a98f76fe7[] = $ice10b700e3771fcda63608142bce93b608228583; } return $i5528ed14b056e3debe4695094269de3a98f76fe7; } public function getGate($i39404799a9171a012cb8b15cd8f27b347aa44a5f, $i30f20aafde612a957f7f966cb5b85e35782bc88a) { $ie8b7b1b62dc29a284d794c9f11a8ee2ea7472eec = $this->getCollection()->addFieldToFilter('type', $i30f20aafde612a957f7f966cb5b85e35782bc88a); foreach ($ie8b7b1b62dc29a284d794c9f11a8ee2ea7472eec as $ice10b700e3771fcda63608142bce93b608228583) { if (preg_match('/^'.$ice10b700e3771fcda63608142bce93b608228583->getArea().'/', $i39404799a9171a012cb8b15cd8f27b347aa44a5f)) { return $ice10b700e3771fcda63608142bce93b608228583; } } return $this->clearInstance(); } public function getInfo() { $ia61712c27ea241bd7a543dc2b02ea572274d0322 = ['payment' => [], 'dph' => null, 'sms' => []]; $i107ca03708f38d42ec504f51f62355fc45d87e69 = explode("%", $this->getData('info')); $i6048c89aa6f25872dad4b719d7b6d821cac48774 = explode('_', $i107ca03708f38d42ec504f51f62355fc45d87e69[0]); $i8e506de2f16bb925ad71fe7bfd4757aeec48a809 = explode(';', $i6048c89aa6f25872dad4b719d7b6d821cac48774[0]); $i9fb8b58187be1d03efeb03cbaa24d23651e7360e = explode(';', $i6048c89aa6f25872dad4b719d7b6d821cac48774[1]); $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][0] = explode(':', $i9fb8b58187be1d03efeb03cbaa24d23651e7360e[0]); $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][1] = explode(':', $i9fb8b58187be1d03efeb03cbaa24d23651e7360e[1]); $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][2] = explode(':', $i9fb8b58187be1d03efeb03cbaa24d23651e7360e[2]); $ia61712c27ea241bd7a543dc2b02ea572274d0322['dph'] = $i107ca03708f38d42ec504f51f62355fc45d87e69[1]; for ($i039030c921e1cb0961cdfe7905a8744d586dd8f5 = 0, $i4024f83408e6f6d27e0b2593aa878f872e5f5abe = count($i8e506de2f16bb925ad71fe7bfd4757aeec48a809); $i039030c921e1cb0961cdfe7905a8744d586dd8f5 < $i4024f83408e6f6d27e0b2593aa878f872e5f5abe; $i039030c921e1cb0961cdfe7905a8744d586dd8f5++) { $ie61606c2d8de1e806ab2adf90e40cc4bb671be43 = explode('|', $i8e506de2f16bb925ad71fe7bfd4757aeec48a809[$i039030c921e1cb0961cdfe7905a8744d586dd8f5]); if ($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 1 || $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 2 || $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 4) { $ia61712c27ea241bd7a543dc2b02ea572274d0322['sms'][0][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[0]][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1]] = [ 'credit' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'sender' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6] : '', 'notice' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8] : '', 'pay1' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][0][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay2' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][1][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay3' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][2][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'unicode' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[4], 'virtual' => strpos($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1], ' . ') !== false]; } if ($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 3) { $ia61712c27ea241bd7a543dc2b02ea572274d0322['sms'][1][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[0]][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1]] = [ 'credit' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'sender' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6] : '', 'notice' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8] : '', 'pay1' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][0][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay2' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][1][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay3' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][2][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'unicode' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[4], 'virtual' => strpos($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1], ' . ') !== false]; } if ($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 1 || $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 2 || $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 5) { $ia61712c27ea241bd7a543dc2b02ea572274d0322['sms'][2][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[0]][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1]] = [ 'credit' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'sender' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6] : '', 'notice' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8] : '', 'pay1' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][0][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay2' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][1][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay3' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][2][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'unicode' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[4], 'virtual' => strpos($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1], ' . ') !== false]; } if ($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 10) { $ia61712c27ea241bd7a543dc2b02ea572274d0322['sms'][3][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[0]][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1]] = [ 'credit' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'sender' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6] : '', 'notice' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8] : '', 'pay1' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][0][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay2' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][1][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay3' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][2][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'unicode' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[4], 'virtual' => strpos($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1], ' . ') !== false]; } if ($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[3] == 32) { $ia61712c27ea241bd7a543dc2b02ea572274d0322['sms'][4][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[0]][$ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1]] = [ 'credit' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'sender' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[6] : '', 'notice' => isset($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8]) ? $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[8] : '', 'pay1' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][0][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay2' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][1][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'pay3' => $ia61712c27ea241bd7a543dc2b02ea572274d0322['payment'][2][1] * $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[2], 'unicode' => $ie61606c2d8de1e806ab2adf90e40cc4bb671be43[4], 'virtual' => strpos($ie61606c2d8de1e806ab2adf90e40cc4bb671be43[1], ' . ') !== false]; } } return $ia61712c27ea241bd7a543dc2b02ea572274d0322; } public function beforeSave() { $i6abff7c4dab2aa28578ae1dc49699ba6b1d18c18 = $this->profile; $ia61712c27ea241bd7a543dc2b02ea572274d0322 = 'action=dostnew&username='.urlencode($i6abff7c4dab2aa28578ae1dc49699ba6b1d18c18->user->getUser()).'&password='.urlencode($i6abff7c4dab2aa28578ae1dc49699ba6b1d18c18->user->getPasswd()).'&area='.urlencode($this->getArea()).'&currency='.$i6abff7c4dab2aa28578ae1dc49699ba6b1d18c18->currency; $i55dd4e7042a1f9031b84f07f04c37165ce3d0720 = $this->api->serverPost($ia61712c27ea241bd7a543dc2b02ea572274d0322); if ($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['errno'] == 1 && !empty($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['data'])) { $this->setInfo($i55dd4e7042a1f9031b84f07f04c37165ce3d0720['datasrc']); } return parent::beforeSave(); } public function beforeDelete() { $i9bd2c88ca2206122845c5e189e2b6856a2409e3a = $this->alternative->getCollection()->addFieldToFilter('route_id', $this->getId()); foreach ($i9bd2c88ca2206122845c5e189e2b6856a2409e3a as $ida3b491904fb073f446bf820cd55a0ff69b347d1) $ida3b491904fb073f446bf820cd55a0ff69b347d1->delete(); return parent::beforeDelete(); } public function validate($ia2537252e3e7dbac0ba1e1693e8531161842da87 = false) { $ieeea3fa58a065e13acdb42aab551831a98e9444c = []; if ($this->getSendertype() == Routes::SENDER_TEXT && $ia2537252e3e7dbac0ba1e1693e8531161842da87 !== false ) { if (!\Zend_Validate::is($this->getSenderId(), 'NotEmpty')) { $ieeea3fa58a065e13acdb42aab551831a98e9444c[] = __('possible characters: ').'a-z A-Z 0-9 _ .'; } elseif (!preg_match('/(?!^\d+$)^[0-9a-zA-Z_.]{3,11}$/', $this->getSenderId())) { $ieeea3fa58a065e13acdb42aab551831a98e9444c[] = __('possible characters: ').'a-z A-Z 0-9 _ .'; } } if (empty($ieeea3fa58a065e13acdb42aab551831a98e9444c)) { return true; } return $ieeea3fa58a065e13acdb42aab551831a98e9444c; } public function updatepricelist() { $ie8b7b1b62dc29a284d794c9f11a8ee2ea7472eec = $this->getCollection(); foreach ($ie8b7b1b62dc29a284d794c9f11a8ee2ea7472eec as $ice10b700e3771fcda63608142bce93b608228583) { $ice10b700e3771fcda63608142bce93b608228583->save(); } return $this; } } 